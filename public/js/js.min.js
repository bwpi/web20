$(document).ready(function(){
    //Глобальные переменные///////////////////////////////////
    const url = location.protocol+'//'+location.host+'/';//Адрес хоста/путь до корневого каталога
    const url_blocks = url+'blocks/';//Адрес хоста/путь до каталога с блоками
    const url_blocks_all = url+'blocks/all/';//Адрес хоста/путь до каталога для общих файлов
    const url_blocks_html = url+'blocks/html/';//Адрес хоста/путь до каталога с основными блоками
    const url_blocks_plug = url+'plugins/';//Адрес хоста/путь до каталога с плагинами
    const url_files_img = url+'files/img/';//Адрес изображений
    const par_for_time = 500;
    var cookie = $.cookie("info");
    var bg_set = $.cookie("bg");
    var admin = $.cookie("admin");
    var date = new Date();
    var minutes = 40; // <--- нужное количество минут
        date.setTime(date.getTime() + (minutes * 60 * 1000));
//////////////////////////////////////////////////////////
////////////Базовые настройки по умолчанию////////////////
// Запрет перехода по ссылкам
$('.historyAPI').on('click', function(e){
   e.preventDefault();
});
$('.edit').remove();
//Основная загрузка коннтента
//Функция обновления контента
function getContentMain(){
    $('#settings, .plus, .del, .save_cont, .save_menu').hide(par_for_time);        
    $('.footer').css('z-index','999');
    $('td, th').removeAttr('contenteditable');    
    $('.plus, .del, .edit').remove();    
    attr = ('html/main');
    content = $('#content').html(); //содержимое файла one
    alert(attr+content);    
    $.ajax({
    type: "POST",
    url: url_blocks_plug+'reload.php',
    data: {one:content,file:attr},
    success: function(data){
        alert(data);        
        }
    });
};
$.ajax({
    url: url_blocks_html+"main.html",
    cache: false,
    success: function(html){   
    $("#content").html(html).hide().toggle(par_for_time);    
    //Загрузка изображений
    //$('.images').each(function(){        
    //    var src = $(this).attr('src');// получение src
    //    $(this).attr('src', url_files_img+src);//Подмена адреса
    //});    
    }
});
$('.save_cont').click(function(){           
            getContentMain();            
            location.reload();
    });
//(this).attr('src', $(this).attr('src').replace('img/', 'img/full/'));
//Скрытые элементы
$('#settings, .save_cont, .save_menu').hide();//Сохранение контента
//Меню ГИА
$('.giaMenu').click(function(){
    $('.work').toggle(par_for_time);
});
//////////////////////////////////////////////////////////
//Раздел работы с куками пользователя
//Модальные окна пользовательских правил
if(cookie==null) {
    $('#usersModal').modal('show');
    $('#workModal').modal('show');
    };
//Фон 1
if(bg_set==1) {
    $("body").first()
       .css("background-color","#333")
       .css("color","#fff")
    };
//Фон 2
if(bg_set==2) {
    $("body").first()
       .css("background-color","#666")
       .css("color","#ccc")
    };
//Фон 3
if(bg_set==3) {
    $("body").first()
       .css("background-color","#EEE")
       .css("color","#666")
    };
//До входа в админку
if(!admin==1) {
    $(".navi_dash").hide();
    $("form.search, .login").show(1000);    
    };
//После входа в админку
if(admin==1)  {
    $(".dash").show(1000);
    $("form.search, .login, .navi_dash").hide(1000);    
}
//Принятие пользовательских правил
$("#sub_users").click(function() {
        $.cookie("info", 1, {expires: date});
    });
//Вход админа
$("#login").click(function() {
        $.cookie("admin", 1);               
    });
//Выход админа
$(".logout").click(function() {
        $.cookie("admin", 0);
        $(".navi_dash").hide();
        $("form.search, .login").show(1000);
    });
//////////////////////////////////
/////////Функци//////////
//Включение подсказок
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
});
//Функция передачи данных из формы кнопке
function OK(){
    $('#addModal').modal('hide');
    $('a.new').attr('href',$('#href').val());//Ссылка
    $('a.new').attr('id',$('#id').val());//Идентификатор
    $('a.new').text($('#name').val());//Название
    $('a.new').removeClass().addClass($('#cl').val()+hAPI);//Классы
    $('a.new').removeClass('new');
    $('#addButtons')[0].reset();
};
//Функция передачи параметров кнопки форме
function formEdit(){
    $('#addModal').modal('show');
    $('#id').val($('.new').attr('id'));
    $('#href').val($('.new').attr('href'));
    $('#name').val($('.new').text().replace('×', ''));
    $('#cl').val($('.new').attr('class'));
};
//Функция добавления кнопок управления
sett = '<button type="button" class="close edit" data-dismiss="alert" aria-label="Close"><i class="fas fa-edit"></i></button>'+
        '<button type="button" class="close del" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>';

///////////////////////////////////
//Настройки администратора
//Добавить пользователя
$('#add_users').click(function(){ 
    $('title').text('Регистрация пользователей');
    $.ajax({  
        url: url_blocks_html+"reg.html",  
        cache: false,  
        success: function(html){
            $("#content").html(html);
            $("#content").html(html).hide().toggle(par_for_time);
        }  
    });        
});
//Чтение файла с пользователями по строчно
$('#users').click(function(){ 
    $('title').text('Пользователи системы');
    $.ajax({  
        url: url+"editors/users.php",  
        cache: false,  
        success: function(html){
            $("#content").html(html);
            $("#content").html('<div class="h3">Пользователи системы</div>'+html).hide().toggle(par_for_time);
            $(".pass_word").hide(par_for_time);
            $("#key").click(function(){ // задаем функцию при нажатиии на элемент с классом toggle
                $(".pass_word").slideToggle(); //  скрываем, или отображаем все элементы <div>
            });
        }  
    });  
});
//Редактирование пользователей
$('#edit').click(function(){ 
    $('title').text('Пользователи системы');
    $.ajax({  
        url: url+"editors/edit_users.php",  
        cache: false,  
        success: function(html){  
            $("#content").html('<div class="h3">Редактирование пользователей</div>'+html);  
        }  
    });  
});
//Редактирование IP пользователей
$('#edit_ip').click(function(){ 
    $('title').text('Пользователи системы');
    $.ajax({  
        url: url+"editors/edit_users_ip.php",  
        cache: false,  
        success: function(html){
            $("#content").html(html);
            $("#content").html('<div class="h3">Редактирование пользователей</div>'+html).hide().toggle(par_for_time);
        }  
    });  
});
//////////////////////////////////////////////////////////

$('#set-checkbox').click(function(){
    if ($(this).is(':checked')){
        $('<a class="plus"><i class="fas fa-plus"></i></a>').insertAfter('.historyAPI, .lp, .href');
        $('.historyAPI, .lp, .href').prepend('<button type="button" class="close edit" data-dismiss="alert" aria-label="Close"><i class="fas fa-edit"></i></button>'+
            '<button type="button" class="close del" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>');
        $('.plus, .del, .edit').addClass('btn bg-transparent');
        $('#settings, .save_cont, .save_menu').show(par_for_time);
        $('.footer').css('z-index','995');
        $('td, th').attr('contenteditable','true');
        $('.del').click(function(){
                $(this).parent().remove();        
            });
        $('.edit').click(function(){
            $(this).parent().addClass('new');
                formEdit();
                $('.off').click(function(){
                    $('#addButtons')[0].reset();
                });
                $('.ok').click(function(){
                   OK();
                });
            });

//Добавление элемента меню
        $('#blank').click(function(){
                    if ($(this).is(':checked')){
                        $('a.new').attr('target','_blank');
                    }
                    else {
                        $('a.new').removeAttr('target');
                    }
                });
        $('#historyAPI').click(function(){
                    if ($(this).is(':checked')){
                        hAPI = ' historyAPI';
                    }
                    else {
                        hAPI = '';
                    }
                });
        $('.plus').click(function(){
            $(this).after('\n  <a class="btn href new">new button'+sett+'</a>');    
            $('.historyAPI').on('click', function(e){
                    e.preventDefault();
                });
                $('.new').click(function(){
                    formEdit();            
                    $('.ok').click(function(){
                        OK();
                    });
                });        
            });    
        }
//Очистка настроек
    else {
        $('#settings, .plus, .del, .save_cont, .save_menu').hide(par_for_time);        
        $('.footer').css('z-index','999');
        $('td, th').removeAttr('contenteditable');
        $('.plus, .del, .edit').hide(par_for_time).remove();        
    }
});
/////////////////////////////////////////////////////    
//Функция изменения левой панели меню
function getLeftPanel(){
    $('.plus, .del, .edit').remove();
    var htmlContent = $('#left_panel').html();
    $.ajax({
    type: "POST",
    url: url_blocks_plug+'reload_left_panel.php',
    data: {one:htmlContent},
    success: function(data){
        alert(data);        
        }
    });
};
//Сохранение меню
/*$('.save_menu').click(function(){
        $('#settings').hide(par_for_time);        
        getLeftPanel();
        $.ajax({  
            url: url_blocks_html+'left_bar.html',  
            cache: false,  
            success: function(html){            
            $("#left_panel").html(html).hide().toggle(par_for_time);
            location.reload();
        }  
    });
});*/
//Настройки темы оформления
$('.bg-setting').click(function(){        
    $('#settings').toggle(par_for_time);        
    $('.footer').css('z-index','995');        
});
$( "#change_bg1" ).click(function() { //Фон 1
    var attr = $(this).attr('id');
    $.cookie("bg", 1, {expires: date});
    $("body").first()
    .css("background-color","#333")
    .css("color","#fff")
    //.css("box-shadow", "inset 0 0 5rem rgba(0, 0, 0, .5)");
});
$( "#change_bg2" ).click(function() { //Фон 2
    $.cookie("bg", 2, {expires: date});
    $("body").first()
    .css("background-color","#666")
    .css("color","#ccc")
    //.css("box-shadow", "inset 0 0 5rem rgba(150, 150, 150, .5)");  
});
    $( "#change_bg3" ).click(function() { //Фон 3
        $.cookie("bg", 3, {expires: date});
       $("body").first()
       .css("background-color","#EEE")
       .css("color","#666")
       //.css("box-shadow", "inset 0 0 5rem rgba(200, 200, 200, .5)");
    });
///////////////////////////////////////////////////
//Функция изменения контента
function getContents(attr){
    $('td').removeAttr('contenteditable','true');
    attr = 'all/'+attr;
    content = $('#content').html(); //содержимое файла one
    alert(attr+content);    
    $.ajax({
    type: "POST",
    url: url_blocks_plug+'reload.php',
    data: {one:content,file:attr},
    success: function(data){
        alert(data);        
        }
    });    
};
//Включение редактирования контента
$('a.editable').click(function(){    
    let attr = $(this).attr('id');    
        $('.save_cont').click(function(){           
            getContents(attr);            
            location.reload();
    });
});
//////////////////////////////////////////////////////
//Боковая панель***********************
/*$('.s_bar').click(function(){ 
    $.ajax({  
        url: url_blocks_html+"left_bar.html",  
        cache: false,  
        success: function(html){
            $("#left_bar").html(html);
            $('.historyAPI').on('click', function(e){      
                e.preventDefault();
                });               
            $('a.rassp, a.kt, a.quest, a.gia, a.report').click(function(){
                var attr = $(this).attr('id');
                $.ajax({  
                    url: url_blocks_all+attr+".html",  
                    cache: false,  
                    success: function(html){
                        $("#content").html(html);
                        //$("#content").html(html).hide().toggle(par_for_time);
                        var title = $('#title').text();
                        $('title').text(title);                            
                        }  
                    });         
                });
            }
        });
    });*/
//Прочие настройки
//Включение расписания в модальном окне
$('.rassp1').click(function(){
    $('title').text('Расписание по Информатике');
    $.ajax({
        url: url_blocks_all+"rassp.html", 
        cache: false,
        success: function(html){
            $(".rassp_modal").html(html);
        }
    });
});
//Опросы для учащихся #content
$('#que_st').click(function(){
    var attr = $(this).attr('id');
    $('title').text('Опросы');
    $.ajax({
        url: url_blocks_all+attr+".html",
        cache: false,
        success: function(html){
            $("#cont_ent").html(html);
        }
    });
});
//Включение календаря в модальном окне
$('#cal1').click(function(){ 
    $('title').text('Календарь');
    $.ajax({
        url: url_blocks_plug+"cal.php",
        cache: false,
        success: function(html){
            $("#cal_modal").html(html);
        }
    });
});
///////////////////////////////////////////////////
//Переключатели между ссылками
$('a.rassp').click(function(){ 
        var href = $(this).attr('href');
        $.ajax({
            url: url + href,
            cache: false,
            success: function(data){
                $("#content").html(data);
                $("#content").html(data).hide().toggle(par_for_time);
                var title = $('#title').text();
                $('title').text(title);
                $('td').attr('contenteditable');
                $("table#time tr:eq(" + a + ")").addClass('bg-info');                
            }  
        });
    });
//Включение левой панели #content
    $('a.kt, a.quest, a.gia, a.report').click(function(){ 
        var attr = $(this).attr('id');
        $.ajax({
            url: url_blocks_all+attr+".html",
            cache: false,
            success: function(html){
                $("#content").html(html);
                $("#content").html(html).hide().toggle(par_for_time);
                var title = $('#title').text();
                $('title').text(title);
                $('td').attr('contenteditable');
            }  
        });
    });
///////////////////////////////////
//Включение календаря #content
    $('a.cal').click(function(){
        $('title').text('Календарь');
        $.ajax({
            url: url_blocks_plug+"cal.php",
            cache: false,  
            success: function(html){
                $("#content").html(html);
                //$("#content").html(html).hide().toggle(par_for_time);
            }  
        }); 
    });
//Боковая панель
    /*$("#sidebar").mCustomScrollbar({
        theme: "minimal"
    });*/

    $('#dismiss, .overlay').on('click', function () {
        $('#sidebar').removeClass('active');
        $('.overlay').removeClass('active');
    });

    $('#sidebarCollapse').on('click', function () {
        $('#sidebar').addClass('active');
        $('.overlay').addClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });
    $('.information').hide().toggle(par_for_time).click(()=>{
        $('.information').hide();
    })
});
